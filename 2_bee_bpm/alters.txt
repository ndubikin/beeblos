#################33####### NOTA IMPORTANTE #############################

### OJO que todo esto está apuntando a bee-bpm-dev pero si estáis trabajando con otra bd como gespro_generic habrá q ejecutarlo para esa también...
### porque las tablas del workflow las utilizamos integradas con el schema de cada app

# nes 20140122
INSERT INTO `bee_bpm_dev`.`w_data_type` (`id`, `name`, `max_length`, `default_length`, `show_name`, `sql_type`) VALUES (8, 'TextArea', 2048, 512, 'TextArea', 12);
UPDATE `bee_bpm_dev`.`w_data_type` SET `insert_date`='2014-01-21 21:44:36', `insert_user`=1000, `mod_user`=1000 WHERE `id`='8';

ALTER TABLE `bee_bpm_dev`.`w_process_head_data_field` CHANGE COLUMN `order` `order` INT(3) NULL DEFAULT '0'  AFTER `active` ;

ALTER TABLE `bee_bpm_dev`.`w_process_head_data_field` 
	ADD COLUMN `synchronize` BIT NOT NULL DEFAULT 0 COMMENT 'allows synchronize with a db or a java class/method'  AFTER `mod_user` , 
	ADD COLUMN `synchrowith` CHAR NULL COMMENT 'J: JDBD / A: APP'  AFTER `synchronize` , 
	ADD COLUMN `schema_` VARCHAR(150) NULL COMMENT 'for JDBC synchro: schema name'  AFTER `synchrowith` , 
	ADD COLUMN `tablename` VARCHAR(150) NULL COMMENT 'for JDBC synchro: table name'  AFTER `schema_` , 
	ADD COLUMN `fieldname` VARCHAR(150) NULL COMMENT 'for JDBC synchro: field name'  AFTER `tablename` , 
	ADD COLUMN `classname` VARCHAR(255) NULL COMMENT 'for APP synchro: class name to execute'  AFTER `fieldname` , 
	ADD COLUMN `get_method` VARCHAR(150) NULL COMMENT 'for APP synchro: method name to execute to get info from external source'  AFTER `classname` , 
	ADD COLUMN `put_method` VARCHAR(150) NULL COMMENT 'for APP synchro: method name to execute to put info into external source'  AFTER `get_method` , 
	ADD COLUMN `paramlist` VARCHAR(150) NULL COMMENT 'for APP synchro: parameter list to send'  AFTER `put_method` , 
	ADD COLUMN `at_process_startup` BIT(1) NULL DEFAULT 0 COMMENT 'synchronize time: at process startup must synchronize getting data from source'  AFTER `paramlist` , 
	ADD COLUMN `at_process_end` BIT(1) NULL DEFAULT 0 COMMENT 'synchronize time: at process ends must synchronize putting data to source'  AFTER `at_process_startup` , 
	ADD COLUMN `when_step_work_is_invoked` BIT(1) NULL DEFAULT 0 COMMENT 'synchronize time: with each new step uploaded must synchronize getting data from source'  AFTER `at_process_end` , 
	ADD COLUMN `when_step_work_is_processed` BIT(1) NULL DEFAULT 0 COMMENT 'synchronize time: with each new step processed must synchronize putting data to source'  AFTER `when_step_work_is_invoked` , 
	CHANGE COLUMN `required` `required` BIT(1) NOT NULL DEFAULT b'0'  ;

ALTER TABLE `bee_bpm_dev`.`w_process_head_data_field` CHANGE COLUMN `order` `order_` INT(3) NULL DEFAULT '0'  ;

ALTER TABLE `bee_bpm_dev`.`w_process_head_managed_data` CHANGE COLUMN `sxema` `schema_` VARCHAR(100) NOT NULL  ;

## nes 20140207 - tabla para definir metodos para interacciones con sistemas externos...
CREATE TABLE `bee_bpm_dev`.`w_process_head_method` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `head_id` int(11) NOT NULL DEFAULT '0',
  `classname` varchar(255) DEFAULT NULL COMMENT 'for APP synchro: class name to execute',
  `methodname` varchar(150) DEFAULT NULL COMMENT 'for APP synchro: method name to execute to get info from external source',
  `type` varchar(1) DEFAULT 'P' COMMENT 'P = put method executes and receives 1 parameter response - G = get method executes and receive 1 loaded object as response',
  `paramlist` varchar(512) DEFAULT NULL COMMENT 'for APP synchro: parameter list to send',
  `at_process_startup` bit(1) DEFAULT b'0' COMMENT 'synchronize time: at process startup must synchronize getting data from source',
  `at_process_end` bit(1) DEFAULT b'0' COMMENT 'synchronize time: at process ends must synchronize putting data to source',
  `when_step_work_is_invoked` bit(1) DEFAULT b'0' COMMENT 'synchronize time: with each new step uploaded must synchronize getting data from source',
  `when_step_work_is_processed` bit(1) DEFAULT b'0' COMMENT 'synchronize time: with each new step processed must synchronize putting data to source',
  `logicalConditionExecution` varchar(512) DEFAULT NULL COMMENT 'logical condition valid form bee-bpm execution environment. If true then executes de method',
  `insert_date` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `insert_user` int(11) NOT NULL DEFAULT '1000',
  `mod_date` datetime DEFAULT '1970-01-01 01:01:00',
  `mod_user` int(11) NOT NULL DEFAULT '1000',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `fk_w_process_head_managed_data_10` (`head_id`),
  CONSTRAINT `fk_w_process_head_managed_data_10` FOREIGN KEY (`head_id`) REFERENCES `w_process_head` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='external methods for interactions with external systems...';

CREATE TABLE `bee_bpm_dev`.`w_stepsequence_method` (
  `id_step_sequence` int(11) NOT NULL,
  `id_method` int(11) NOT NULL,
  `enabled` bit(1) DEFAULT b'1',
  `insert_user` int(11) NOT NULL,
  `insert_date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id_step_sequence`,`id_method`) USING BTREE,
  KEY `ix_role` (`id_step_sequence`),
  KEY `ix_user` (`id_method`),
  KEY `fk_w_stepsequence_method_1` (`id_step_sequence`),
  KEY `fk_w_stepsequence_method_2` (`id_method`),
  CONSTRAINT `fk_w_stepsequence_method_1` FOREIGN KEY (`id_step_sequence`) REFERENCES `w_step_sequence_def` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `fk_w_stepsequence_method_2` FOREIGN KEY (`id_method`) REFERENCES `w_process_head_methods` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='relation w-step-sequence-def with w-process-head-methods';

ALTER TABLE `bee_bpm_dev`.`w_process_head_data_field` 
COMMENT = 'Para definir los datafields pertenecientes a los procesos. Se definen aqui a nivel de WProcessHead y luego se puede dar visibilidad en cada step' ;

## nes 20140705 - quito algunos not null que inicializabamos a cero y que en realidad no serían requeridos ...
ALTER TABLE `bee_bpm_dev`.`w_step_work_assignment` 
CHANGE COLUMN `reassigned_date` `reassigned_date` TIMESTAMP NULL DEFAULT NULL COMMENT 'TIMESTAMP CON LA REASIGNACIÓN'; 
ALTER TABLE `bee_bpm_dev`.`w_step_work_assignment` 
CHANGE COLUMN `from_reassignment_date` `from_reassignment_date` TIMESTAMP NULL DEFAULT NULL COMMENT 'TIMESTAMP CON LA REASIGNACIÓN' ;
ALTER TABLE `bee_bpm_dev`.`w_step_work_assignment` 
CHANGE COLUMN `insert_date` `insert_date` TIMESTAMP NULL DEFAULT NULL ,
CHANGE COLUMN `insert_user` `insert_user` INT(11) NULL DEFAULT NULL ;

ALTER TABLE `bee_bpm_dev`.`w_step_def` 
ADD COLUMN `id_user_assignment_method` INT DEFAULT NULL AFTER `expired_user_notice`;