<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich">
 
 
 <style>
    .center{
        text-align:center;
    }
    .rich-datascr-button{
      	width:40px;
       	font-size:95%;
    }
</style>

<h:form id="frmListaTarea">

	    <rich:contextMenu attached="false" id="menuProcesarTareas" submitMode="ajax">
	         <rich:menuItem ajaxSingle="true"   action="#{consultaTareaBean.cargarPaso}" submitMode="server"
	         				style="{styleItemProcesar}">
	             <b> ( Procesar ) </b> {referencia} {comentarios} 
	             <a4j:actionparam name="det3" assignTo="#{consultaTareaBean.idObject}" value="{id_object}"/>  
	             <a4j:actionparam name="det4" assignTo="#{consultaTareaBean.idObjectType}" value="{id_object_type}"/>
	             <a4j:actionparam name="det5" assignTo="#{consultaTareaBean.idPasoProceso}" value="{id_tarea}"/>                 
	        </rich:menuItem>

  	       <rich:menuItem ajaxSingle="true"   action="#{consultaTareaBean.desbloquearDesdeMenuItem}" submitMode="server"
         		style="{styleItemDesbloquear}">
         	    <b> ( Desbloquear ) </b> {referencia} {comentarios} 
            	<a4j:actionparam name="det3" assignTo="#{consultaTareaBean.idObject}" value="{id_object}"/>  
            	<a4j:actionparam name="det4" assignTo="#{consultaTareaBean.idObjectType}" value="{id_object_type}"/>
             	<a4j:actionparam name="det5" assignTo="#{consultaTareaBean.idPasoProceso}" value="{id_tarea}"/>                 
     
    	    </rich:menuItem>  
    	    
  	       <rich:menuItem ajaxSingle="true"   action="#{consultaTareaBean.cargaFichaProyecto}" submitMode="server"
         		style="{styleItemVerProyecto}">
         	    <b> ( Ver Ficha de Proyecto ) </b> {id_object} {comentarios} 
            	<a4j:actionparam name="det3" assignTo="#{consultaTareaBean.idObject}" value="{id_object}"/>  
            	<a4j:actionparam name="det4" assignTo="#{consultaTareaBean.idObjectType}" value="{id_object_type}"/>
             	<a4j:actionparam name="det5" assignTo="#{consultaTareaBean.idPasoProceso}" value="{id_tarea}"/>                 
     
    	    </rich:menuItem>  
        
        	<rich:menuItem ajaxSingle="true"   submitMode="client" style="{styleMensajeItemBloqueado}">
	             <b> No puede procesar esta tarea porque está bloqueada por el usuario {usuarioBloqueadorNombre} desde el: {bloqueadoDesde} </b>  
	    	</rich:menuItem>

	    </rich:contextMenu>   

		<rich:datascroller  id="dsUp" 
        		for="listaTareasTable" maxPages="10" 
				reRender="frmListaTarea" renderIfSinglePage="false"
				pageIndexVar="pageIndex" pagesVar="pages">
 			
 			<f:facet name="first">
	                   <h:outputText value="1..." />
            </f:facet>
 			<f:facet name="last">
	                   <h:outputText value="...#{pages}" />
            </f:facet>
            <f:facet name="first_disabled">
	                   <h:outputText value="1..." />
            </f:facet>
 			<f:facet name="last_disabled">
	                   <h:outputText value="... #{pages}" />
            </f:facet>
            <h:outputText value="#{pages}" />
               
        </rich:datascroller>		
	
	    <rich:dataTable id="listaTareasTable" value="#{consultaTareaBean.lTareas}" 
	    		onRowMouseOver="this.style.backgroundColor='#F1F1F1'"
				onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
	    		var="tarea" width="98%" columnClasses="center"
	    		rows="8" reRender="frmListaTarea,dsUp,dsDown" style="margin-left: 16px;">
	        <f:facet name="header">
	            <h:outputText value="#{msg.label_consultaDeTareas} ( #{consultaTareaBean.nResultados} #{msg.label_results} )"/>
	        </f:facet>
	
	        <rich:column sortBy="#{tarea.process.name}" style="width:90px; text-align: left;"> 
	            <f:facet name="header">
	                <h:outputText value="#{msg.label_proceso}"/>
	            </f:facet>
	            <h:outputText value=" ! " style="color: red; font-weight:bold;"
	            				title="Item bloqueado por otro usuario" 
	            				rendered="#{tarea.locked eq true and tarea.lockedBy.id!=consultaTareaBean.usuarioLogueado}"/>
	            <h:outputText value=" ! " style="color: green; font-weight:bold;"
	            				title="Este item está bloqueado por usted desde el #{tarea.lockedSince}" 
	            				rendered="#{tarea.locked eq true and tarea.lockedBy.id eq consultaTareaBean.usuarioLogueado}"/>
	            <h:outputText value="#{tarea.process.name}"/>
	        </rich:column>
	
	        <rich:column sortBy="#{tarea.idObject}" style="width:40px; text-align: left;"> 
	            <f:facet name="header">
	                <h:outputText value="#{msg.label_id}"/>
	            </f:facet>
	            <h:outputText value="#{tarea.idObject}" rendered="#{tarea.comments eq nul}"/>
	            <h:outputText value="#{tarea.reference}" rendered="#{tarea.comments != null}" style="padding: 4px;font-weight: bold;"/>	            
	        </rich:column>
	
	        <rich:column sortBy="#{tarea.idObjectType}" style="width:120px; text-align: left;"> 
	            <f:facet name="header">
	                <h:outputText value="#{msg.label_referencia}"/>
	            </f:facet>
	            <h:outputText value="#{tarea.idObjectType}" rendered="#{tarea.comments eq nul}"/>
   	            <h:outputText value="#{tarea.comments}" rendered="#{tarea.comments != null}"/>
	        </rich:column>
	
	        <rich:column sortBy="#{tarea.currentStep.name}" style="width:90px; text-align: left;"> 
	            <f:facet name="header">
	                <h:outputText value="#{msg.label_paso}"/>
	            </f:facet>
	            <h:panelGrid columns="1">
		            <h:outputText value="#{tarea.currentStep.name}"  style="#{tarea.openedDate eq null ? 'font-weight:bold;' : ''}"/>
		            <h:outputText value="(paso devuelto)" style="color: red;" rendered="#{tarea.sentBack eq true}"/>
	            </h:panelGrid>
	        </rich:column>
	        
	        <rich:column sortBy="#{tarea.arrivingDate}" style="width:50px; text-align: left;"> 
	            <f:facet name="header">
	                <h:outputText value="#{msg.label_llego_el}"/>
	            </f:facet>
	            <h:outputText value="#{tarea.arrivingDate}">
	               	<f:converter converterId="SPDateConverter"/>
	            </h:outputText>
	        </rich:column>
	
	        <rich:column sortBy="#{tarea.openedDate}" style="width:50px; text-align: left;"> 
	            <f:facet name="header">
	                <h:outputText value="#{msg.label_revisado_el}"/>
	            </f:facet>
	            <h:outputText value="#{tarea.openedDate}">
	               	<f:converter converterId="SPDateConverter"/>
	            </h:outputText>
	        </rich:column>
	
	        <rich:column sortBy="#{tarea.deadlineDate}" style="width:50px; text-align: left; font-weight: bold; "> 
	            <f:facet name="header">
	                <h:outputText value="#{msg.label_F_Limite}"/>
	            </f:facet>
	            <h:outputText value="#{tarea.deadlineDate}" >
	               	<f:converter converterId="SPDateConverter"/>
	            </h:outputText>
	        </rich:column>
	        
	        <rich:column sortBy="#{tarea.deadlineTime}" style="width:50px; text-align: left;"> 
	            <f:facet name="header">
	                <h:outputText value="#{msg.label_horaLimite}"/>
	            </f:facet>
	            <h:outputText value="#{tarea.deadlineTime}">
	               	<f:convertDateTime pattern="hh:mm" timeZone="GMT+1"/>
	            </h:outputText>
	        </rich:column>
	        
	         <rich:componentControl event="onRowClick" for="menuProcesarTareas" operation="show">
	            <f:param value="#{tarea.idObject}" name="id_object"/>
	            <f:param value="#{tarea.idObjectType}" name="id_object_type"/>
	            <f:param value="#{tarea.reference}" name="referencia"/>
	            <f:param value="#{tarea.comments}" name="comentarios"/>
	            <f:param value="#{tarea.id}" name="id_tarea"/>     
	            <f:param value="#{tarea.locked eq true and tarea.lockedBy.id!=consultaTareaBean.usuarioLogueado ? 'display:none;' : ''}" name="styleItemProcesar"/>	                      
	            <f:param value="#{tarea.locked eq true and tarea.lockedBy.id!=consultaTareaBean.usuarioLogueado ? '' : 'display:none;'}" name="styleMensajeItemBloqueado"/>
				<f:param value="#{tarea.lockedBy.name}" name="usuarioBloqueadorNombre"/>
				<f:param value="#{tarea.lockedSince}" name="bloqueadoDesde"/>
          		<f:param value="#{tarea.locked eq true and tarea.lockedBy.id eq consultaTareaBean.usuarioLogueado? '' : 'display:none;'}" name="styleItemDesbloquear"/>
          		<f:param value="#{tarea.idObjectType == 'com.softpoint.bdc.model.Proyecto' ? '' : 'display:none;'}" name="styleItemVerProyecto"/>
	        </rich:componentControl>        
	    </rich:dataTable>

	
		<rich:datascroller  id="dsdown" 
        		for="listaTareasTable" maxPages="10"  
				reRender="frmListaTarea" renderIfSinglePage="false"
				pageIndexVar="pageIndex" pagesVar="pages">
 			
 			<f:facet name="first">
	                   <h:outputText value="1..." />
            </f:facet>
 			<f:facet name="last">
	                   <h:outputText value="...#{pages}" />
            </f:facet>
            <f:facet name="first_disabled">
	                   <h:outputText value="1..." />
            </f:facet>
 			<f:facet name="last_disabled">
	                   <h:outputText value="... #{pages}" />
            </f:facet>
            <h:outputText value="#{pages}" />
               
        </rich:datascroller>
        
</h:form>
        		

</ui:composition>